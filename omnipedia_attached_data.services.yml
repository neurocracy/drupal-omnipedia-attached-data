services:

  # The OmnipediaAttachedData plug-in manager.
  plugin.manager.omnipedia_attached_data:
    class: Drupal\omnipedia_attached_data\OmnipediaAttachedDataManager
    parent: default_plugin_manager

  # Event subscriber to add attached data cache tags to appropriate fields.
  omnipedia_attached_data.attached_data_cache_tags_preprocess_field_event_subscriber:
    class: Drupal\omnipedia_attached_data\EventSubscriber\Preprocess\AttachedDataCacheTagsPreprocessFieldEventSubscriber
    arguments:
      - '@entity_type.manager'
      - '@omnipedia.wiki_node_resolver'
    tags:
      - { name: 'event_subscriber' }

  # Event subscriber to attach data to matching Wikimedia links.
  omnipedia_attached_data.wikimedia_link_build_event_subscriber:
    class: Drupal\omnipedia_attached_data\EventSubscriber\Omnipedia\WikimediaLinkBuildEventSubscriber
    arguments:
      - '@plugin.manager.omnipedia_attached_data'
    tags:
      - { name: 'event_subscriber' }
